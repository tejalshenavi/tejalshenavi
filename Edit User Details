import React, { useState, useEffect } from 'react';
import firebase from 'firebase/app';
import 'firebase/auth';
import 'firebase/firestore';

const ProfileForm = ({ user, onUpdateProfile }) => {
  const [displayName, setDisplayName] = useState(user.displayName || '');
  const [phoneNumber, setPhoneNumber] = useState(user.phoneNumber || '');

  useEffect(() => {
    // Fetch user's profile data from Firebase on component mount
    const fetchProfileData = async () => {
      try {
        const idToken = await firebase.auth().currentUser.getIdToken();
        const response = await fetch(
          `https://your-firebase-project-url.firebaseio.com/users/${idToken}.json`
        );
        const data = await response.json();
        
        if (data) {
          setDisplayName(data.displayName || '');
          setPhoneNumber(data.phoneNumber || '');
        }
      } catch (error) {
        console.error('Error fetching profile data:', error.message);
      }
    };

    fetchProfileData();
  }, []);

  const handleUpdateProfile = async () => {
    const updatedProfile = {
      displayName,
      phoneNumber,
    };

    try {
      const idToken = await firebase.auth().currentUser.getIdToken();

      // Update the user's profile details in Firebase
      await firebase
        .auth()
        .currentUser.updateProfile(updatedProfile);

      // Update the user's profile data in your Firebase database
      await fetch(
        `https://your-firebase-project-url.firebaseio.com/users/${idToken}.json`,
        {
          method: 'PUT',
          body: JSON.stringify(updatedProfile),
        }
      );

      onUpdateProfile(updatedProfile);
    } catch (error) {
      console.error('Error updating profile:', error.message);
    }
  };

  return (
    <div>
      <h2>Complete Your Profile</h2>
      <div>
        <label>Display Name:</label>
        <input
          type="text"
          value={displayName}
          onChange={(e) => setDisplayName(e.target.value)}
        />
      </div>
      <div>
        <label>Phone Number:</label>
        <input
          type="text"
          value={phoneNumber}
          onChange={(e) => setPhoneNumber(e.target.value)}
        />
      </div>
      <button onClick={handleUpdateProfile}>Update</button>
    </div>
  );
};

export default ProfileForm;


